# Excel转JSON解析器 - 进度文档

## 项目状态：已完成 ✅

## 已完成的任务

### 1. 项目配置 ✅
- [x] 创建 `pom.xml` 文件
- [x] 配置Maven依赖（Apache POI 5.2.3, Jackson 2.15.2）
- [x] 设置Java 8编译配置

### 2. 数据模型类 ✅
- [x] `Event.java` - 事件数据模型（type, id, weight）
- [x] `Cell.java` - 单元格数据模型（x, y, tileId, events）
- [x] `MapData.java` - 地图数据模型（mapId, width, height, cells）

### 3. Excel解析器 ✅
- [x] `ExcelParser.java` - 实现Excel读取和解析逻辑
  - [x] 支持读取.xlsx格式文件
  - [x] 跳过标题行（第1-3行）
  - [x] 从第4行开始读取数据
  - [x] 解析pos列并转换为x, y坐标
  - [x] 解析最多3个事件（event1, event2, event3）
  - [x] 处理空值情况

### 4. 主程序 ✅
- [x] `ExcelToJsonConverter.java` - 主类，包含main方法
  - [x] 支持命令行参数
  - [x] 默认参数配置
  - [x] **根据Excel文件名自动生成JSON文件名**
  - [x] JSON格式化输出
  - [x] 文件存在性检查
  - [x] 错误处理和友好的输出信息

### 5. 文档 ✅
- [x] `README.md` - 使用说明文档
- [x] `进度文档.md` - 项目进度跟踪

## Excel与JSON映射关系

### 字段映射
- **pos (A列)** → 通过公式计算 `x = (pos-1) % width`, `y = (pos-1) / width`
- **event1, percent1, id1 (B,C,D列)** → `events[0]`
- **event2, percent2, id2 (E,F,G列)** → `events[1]`（可选）
- **event3, percent3, id3 (H,I,J列)** → `events[2]`（可选）
- **tileId** → 固定值0
- **mapId, width, height** → 通过命令行参数传入

## 使用方法

### 方式一：直接运行（推荐）
1. 将Excel文件放在 `src/main/resources/map.xlsx`（或其他路径）
2. 直接运行main方法，程序会自动：
   - 读取Excel文件
   - 根据Excel文件名生成对应的JSON文件名（例如：`map.xlsx` → `output/map.json`）
   - 输出JSON文件到 `output` 目录

### 方式二：使用命令行参数
```bash
mvn exec:java -Dexec.mainClass="com.excelparser.ExcelToJsonConverter" -Dexec.args="Excel路径 mapId width height"
```

**注意**：JSON文件名会根据Excel文件名自动生成，无需手动指定输出路径。

## 输出
- JSON文件输出到 `output/map.json`
- 控制台显示解析进度和结果

## 已修复的问题
- [x] **类型冲突问题**：修复了Apache POI的`Cell`类与自定义`Cell`模型类的冲突，使用完整类名区分
- [x] **公式单元格支持**：添加了`FormulaEvaluator`，现在可以正确读取和计算公式单元格的值

## 下一步（如需要）
- [ ] 添加单元测试
- [ ] 支持更多Excel格式变体
- [ ] 添加配置文件支持
- [ ] 优化错误提示信息
